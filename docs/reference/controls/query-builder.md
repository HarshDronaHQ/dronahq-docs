---
sidebar_position: 1
title: Query Builder
---

import Image from '@site/src/components/Image';
import VersionedLink from '@site/src/components/VersionedLink';
import Thumbnail from '@site/src/components/Thumbnail';


The Query Builder control empowers you to create custom queries for situations requiring server-side filtering, utilizing criteria defined during runtime. By integrating it with your connectors, you can dynamically select and apply queries to your data sources. This advantageously enables dynamic filtering for controls like Table Grid and List controls, ensuring efficient data retrieval based on specific criteria.

<figure>
  <Thumbnail src="/img/reference/controls/query-builder/preview.jpeg" alt="Query Builder" />
  <figcaption align = "center"><i>Query Builder</i></figcaption>
</figure>

## Binding Data Options

The Query Builder control offers two data binding options to display. There are different ways in which you can bind data to the Query Builder control.

### RAW_JSON

With the RAW_JSON option, you can directly input the query in RAW_JSON format. This allows for precise control over the query structure, enabling you to define complex filter conditions in detail.

```json
{
	"id": "g-RQpZdXIWdZhAmFoJO",
	"rules": [],
	"orderBy": [
		{
			"id": "o-RvsitaQBPeStckGkC",
			"field": "username",
			"direction": "asc"
		}
	],
	"combinator": "AND"
}
```

However, you can also dynamically fetch this data using Bind options by retrieving information from `Data queries`, `Sheets`, or `Custom functions` and binding the response to the Data Bind option.

### Query
The Query option provides a more intuitive and user-friendly approach to constructing queries. Utilizing the control's visual interface, you can interactively build queries. This visual representation simplifies the process, making it easier to understand and troubleshoot complex queries.

Suppose you have a database with a table named `employees` containing information about employees such as `id`, `name`, `age`, and `department`. You want to create a query using the Query Builder control to filter employees based on their department and age.

1. Define Query for MySQL Connector:
   - Create a variable called `employeeQuery`.
   - Use the dynamic variable feature of the Query Builder control to append the WHERE clause to your SQL. For example:
     ```sql
     SELECT * FROM employees WHERE department = {department} AND age > {min_age}
     ```

2. Configure Schema Field:
   - In the Popup screen, configure the Schema field to specify the JSON Key-Value format for filtering fields. For example:
     ```json
     {
       "department": "string",
       "min_age": "number"
     }
     ```

3. Display SQL and JSON Filters (Optional):
   - Use Text Input controls to display the SQL and JSON filters generated by the Query Builder control. For example:
     - SQL Filter: `SELECT * FROM employees WHERE department = 'Sales' AND age > 30`
     - JSON Filter: `{ "department": "Sales", "min_age": 30 }`

4. Add `on_apply` Action:
   - Add an `on_apply` Action to the Apply button of the Query Builder control.
   - Specify navigation back to the screen containing the TableGrid control.

5. Bind Data to TableGrid Control:
   - Bind data from the connector to the TableGrid control by selecting `TableGrid control > Quick Select > Connector Library`.
   - Choose the `employees` table from the connector.

### Schema Binding (Structure building)

Schema binding in properties allows you to specify the structure of your data, similar to data binding but focusing on the format and type of data expected. This approach provides clarity and organization, enabling seamless integration and manipulation within your application.

Here's how you can use schema binding:

1. Define the Schema: Use JSON notation to define the structure of your data. Include key-value pairs to represent each field along with its data type. For example:
     ```json
     {
       "ProductName": "string",
       "ProductID": "string",
       "Price": "number",
       "Quantity": "number"
     }
     ```

2. Apply the Schema: Apply the schema to relevant controls such as TableGrid, Form, or List controls. This ensures that the controls align with the specified data structure.

3. Bind the Schema: Use the Bind Data Section to bind the schema to the control. This allows the control to fetch data dynamically from data queries, sheets, or custom functions and display it according to the specified schema.




## Properties

| Property       | Description                                                                                                           |
|----------------|-----------------------------------------------------------------------------------------------------------------------|
| Database       | Specifies the type of database (SQL or NoSQL) for sending the query. When using NoSQL, Dynamic Operators can be added. |
| Theme          | Defines the color scheme or theme for the composite control.                                                          |
| Schema         | JSON format containing fields available for use in the query builder.                                                  |
|Order By | Toggles the option to include sorting criteria in the query results. |

And here's an example of the Schema for a Product data use case:

```json
[
  {
    "label": "Product Name",
    "value": "ProductName",
    "enum": [
      {
        "label": "Sandwich",
        "value": "Sandwich"
      },
      {
        "label": "Burger",
        "value": "Burger"
      },
      {
        "label": "All",
        "value": ""
      }
    ]
  },
  {
    "label": "Product ID",
    "value": "ProductID"
  },
  {
    "label": "Price",
    "value": "Price",
    "type": "number"
  },
  {
    "label": "Prod Quantity",
    "value": "Quantity"
  }
]
```

Dynamic Operators

The Dynamic Operators feature in the Query Builder control allows you to add custom operators that are not available by default. This enables you to define specific operators for different types of data you use in your application. You can easily customize the operators to support String type data within DronaHQ.

Key Points:

1. For String type data, the control automatically adds double quotes to the value field in the resolved output JSON query.

2. For other data types, you must provide a value that is supported in your NoSQL parameter. For instance, the $all operator expects an array type in the value field, so it's essential to provide an array value in the query control.

To add your specific operators, go to the Dynamic Operator section under Properties, and customize the operators to support String type data in DronaHQ.

<figure>
  <Thumbnail src="/img/reference/controls/query-builder/example-1.jpeg" alt="Dynamic Operator" />
  <figcaption align = "center"><i>Dynamic Operator</i></figcaption>
</figure>

Whenever you run the form and create queries using the additional operators, you will see them listed for String type data. For example, in the illustration provided, the query is built for the Product ID using the $Exists operator.

By leveraging Dynamic Operators, you gain more flexibility and control over your queries, allowing you to tailor them to the specific needs of your application.

Dynamic Operators Example:

Query:

```
{
  "ProductID": {
    "$Exists": true
  }
}
```

In this example, the query uses the $Exists operator to check if the Product ID exists in the data.

<figure>
  <Thumbnail src="/img/reference/controls/query-builder/example-2.jpeg" alt="Query Builder" />
</figure>

## Control Output

The outputs from the Query Builder control, represented by the placeholders `{{querybuilder.Raw_JSON}}` and `{{querybuilder.Query}}`, can be referenced in other controls, data queries, or JavaScript functions using the control's unique name.

| Output                 | Description                                                                                                  |
|------------------------|--------------------------------------------------------------------------------------------------------------|
| querybuilder.Raw_JSON     | Represents the query in RAW_JSON format, providing precise control over the query structure.                 |
| querybuilder.Query        | Represents the query in a user-friendly format, simplifying the process of building complex queries.         |


## Events

| Trigger       | Description                                                                                                               |
|---------------|---------------------------------------------------------------------------------------------------------------------------|
| On_apply      | Triggered when you select the query parameters and click the Apply button to apply the specified filters or search criteria.|
| On_clear      | Triggered when you click the clear button to reset or remove any applied filters, returning the data to its original state. |
